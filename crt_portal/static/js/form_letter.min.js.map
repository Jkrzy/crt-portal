{"version":3,"file":"form_letter.min.js","sources":["form_letter.js"],"sourcesContent":["(function(root) {\n  var modal = document.getElementById('intake_template');\n\n  var contact = document.getElementById('contact_complainant');\n  var showModal = function(event) {\n    event.preventDefault();\n    if (modal.getAttribute('hidden') !== null) {\n      root.CRT.openModal(modal);\n    } else {\n      root.CRT.closeModal(modal);\n    }\n  };\n  contact.addEventListener('click', showModal);\n\n  var cancel_modal = document.getElementById('intake_template_cancel');\n  root.CRT.cancelModal(modal, cancel_modal);\n\n  var copy = document.getElementById('intake_copy');\n  var print = document.getElementById('intake_print');\n  var letter = document.getElementById('intake_letter');\n  var send_email = document.getElementById('intake_send');\n\n  var email_enabled = document.getElementById('intake_send').dataset.emailEnabled === 'True';\n  var has_contact_email = Boolean(document.getElementById('contact_email').dataset.email);\n\n  var reset = function() {\n    description.innerHTML = '(select a response template)';\n    letter.innerHTML = '';\n    copy.setAttribute('disabled', 'disabled');\n    print.setAttribute('disabled', 'disabled');\n    send_email.setAttribute('disabled', 'disabled');\n  };\n\n  var description = document.getElementById('intake_description');\n  var options = document.getElementById('intake_select');\n  options.onchange = function(event) {\n    event.preventDefault();\n    var index = event.target.selectedIndex;\n    var option = event.target.options[index];\n    description.innerHTML = option.dataset['description'] || '(select a response template)';\n    letter.innerHTML = option.dataset['content'] || '';\n    if (index >= 1) {\n      copy.removeAttribute('disabled');\n      print.removeAttribute('disabled');\n      if (email_enabled && has_contact_email) {\n        send_email.removeAttribute('disabled');\n      }\n    } else {\n      reset();\n    }\n  };\n\n  var setLanguageCookie = function(lang) {\n    document.cookie = 'form-letter-language' + '=' + lang;\n  };\n\n  var getLanguageCookie = function() {\n    var nameEQ = 'form-letter-language=';\n    var ca = document.cookie.split(';');\n    for (var i = 0; i < ca.length; i++) {\n      var c = ca[i];\n      while (c.charAt(0) == ' ') c = c.substring(1, c.length);\n      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);\n    }\n    return null;\n  };\n\n  var applyTemplateLanguageFilter = function() {\n    var language_select = document.getElementById('template-language-select');\n    var selected_language = language_select.value;\n\n    // form letters for languages other than the one selected\n    var toHide = document.querySelectorAll(\n      `#intake_select > option.usa-select:not([data-language=${selected_language}])`\n    );\n    // form letters for the language that is selected\n    var toShow = document.querySelectorAll(\n      `#intake_select > option.usa-select[data-language=${selected_language}]`\n    );\n\n    for (var el of toHide) {\n      el.setAttribute('hidden', 'true');\n    }\n\n    for (var el of toShow) {\n      el.removeAttribute('hidden');\n    }\n\n    // the selected language changed, clear the currently selected form letter\n    var intake_select = document.getElementById('intake_select');\n    intake_select.selectedIndex = 0;\n    reset();\n  };\n\n  var language_select = document.getElementById('template-language-select');\n  language_select.onchange = function(event) {\n    event.preventDefault();\n    applyTemplateLanguageFilter();\n    setLanguageCookie(language_select.value);\n  };\n\n  // try to grab the most recently used language setting\n  if (getLanguageCookie()) {\n    // if there is one, set the dropdown back to that value\n    language_select.value = getLanguageCookie();\n  }\n  // refresh the template dropdown to reflect the current language selection\n  applyTemplateLanguageFilter();\n\n  var copyContents = function(event) {\n    const el = document.createElement('textarea');\n    el.value = description.innerText + '\\n\\n' + letter.value;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-9999px';\n    document.body.appendChild(el);\n    el.select();\n    el.setSelectionRange(0, 99999); // mobile\n    document.execCommand('copy');\n    document.body.removeChild(el);\n  };\n  copy.addEventListener('click', copyContents);\n\n  var printContents = function(event) {\n    const letterhead = document.getElementById('form-letterhead');\n    const letter_placeholder = document.getElementById('form-letter--placeholder');\n    const el = document.createElement('p');\n    el.append(letter.value);\n    letter_placeholder.appendChild(el);\n    letterhead.removeAttribute('hidden');\n    document.body.appendChild(letterhead);\n    window.print();\n    el.remove();\n    document.body.removeChild(letterhead);\n    root.CRT.closeModal(modal);\n  };\n  print.addEventListener('click', printContents);\n})(window);\n"],"names":["root","modal","document","getElementById","addEventListener","event","preventDefault","getAttribute","CRT","openModal","closeModal","cancel_modal","cancelModal","reset","description","innerHTML","letter","copy","setAttribute","print","send_email","email_enabled","dataset","emailEnabled","has_contact_email","Boolean","email","onchange","index","target","selectedIndex","option","options","removeAttribute","applyTemplateLanguageFilter","el","selected_language","value","toHide","querySelectorAll","toShow","getLanguageCookie","nameEQ","ca","cookie","split","i","length","c","charAt","substring","indexOf","language_select","lang","createElement","innerText","style","position","left","body","appendChild","select","setSelectionRange","execCommand","removeChild","letterhead","letter_placeholder","append","window","remove"],"mappings":"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"}