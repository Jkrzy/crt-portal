{"version":3,"file":"url_params_polyfill.min.js","sources":["url_params_polyfill.js"],"sourcesContent":["/**\n *\n *\n * @author Jerry Bendy <jerry@icewingcc.com>\n * @licence MIT\n *\n */\n\n(function(self) {\n  'use strict';\n\n  var nativeURLSearchParams =\n      self.URLSearchParams && self.URLSearchParams.prototype.get ? self.URLSearchParams : null,\n    isSupportObjectConstructor =\n      nativeURLSearchParams && new nativeURLSearchParams({ a: 1 }).toString() === 'a=1',\n    // There is a bug in safari 10.1 (and earlier) that incorrectly decodes `%2B` as an empty space and not a plus.\n    decodesPlusesCorrectly =\n      nativeURLSearchParams && new nativeURLSearchParams('s=%2B').get('s') === '+',\n    __URLSearchParams__ = '__URLSearchParams__',\n    // Fix bug in Edge which cannot encode ' &' correctly\n    encodesAmpersandsCorrectly = nativeURLSearchParams\n      ? (function() {\n          var ampersandTest = new nativeURLSearchParams();\n          ampersandTest.append('s', ' &');\n          return ampersandTest.toString() === 's=+%26';\n        })()\n      : true,\n    prototype = URLSearchParamsPolyfill.prototype,\n    iterable = !!(self.Symbol && self.Symbol.iterator);\n\n  if (\n    nativeURLSearchParams &&\n    isSupportObjectConstructor &&\n    decodesPlusesCorrectly &&\n    encodesAmpersandsCorrectly\n  ) {\n    return;\n  }\n\n  /**\n   * Make a URLSearchParams instance\n   *\n   * @param {object|string|URLSearchParams} search\n   * @constructor\n   */\n  function URLSearchParamsPolyfill(search) {\n    search = search || '';\n\n    // support construct object with another URLSearchParams instance\n    if (search instanceof URLSearchParams || search instanceof URLSearchParamsPolyfill) {\n      search = search.toString();\n    }\n    this[__URLSearchParams__] = parseToDict(search);\n  }\n\n  /**\n   * Appends a specified key/value pair as a new search parameter.\n   *\n   * @param {string} name\n   * @param {string} value\n   */\n  prototype.append = function(name, value) {\n    appendTo(this[__URLSearchParams__], name, value);\n  };\n\n  /**\n   * Deletes the given search parameter, and its associated value,\n   * from the list of all search parameters.\n   *\n   * @param {string} name\n   */\n  prototype['delete'] = function(name) {\n    delete this[__URLSearchParams__][name];\n  };\n\n  /**\n   * Returns the first value associated to the given search parameter.\n   *\n   * @param {string} name\n   * @returns {string|null}\n   */\n  prototype.get = function(name) {\n    var dict = this[__URLSearchParams__];\n    return name in dict ? dict[name][0] : null;\n  };\n\n  /**\n   * Returns all the values association with a given search parameter.\n   *\n   * @param {string} name\n   * @returns {Array}\n   */\n  prototype.getAll = function(name) {\n    var dict = this[__URLSearchParams__];\n    return name in dict ? dict[name].slice(0) : [];\n  };\n\n  /**\n   * Returns a Boolean indicating if such a search parameter exists.\n   *\n   * @param {string} name\n   * @returns {boolean}\n   */\n  prototype.has = function(name) {\n    return name in this[__URLSearchParams__];\n  };\n\n  /**\n   * Sets the value associated to a given search parameter to\n   * the given value. If there were several values, delete the\n   * others.\n   *\n   * @param {string} name\n   * @param {string} value\n   */\n  prototype.set = function set(name, value) {\n    this[__URLSearchParams__][name] = ['' + value];\n  };\n\n  /**\n   * Returns a string containg a query string suitable for use in a URL.\n   *\n   * @returns {string}\n   */\n  prototype.toString = function() {\n    var dict = this[__URLSearchParams__],\n      query = [],\n      i,\n      key,\n      name,\n      value;\n    for (key in dict) {\n      name = encode(key);\n      for (i = 0, value = dict[key]; i < value.length; i++) {\n        query.push(name + '=' + encode(value[i]));\n      }\n    }\n    return query.join('&');\n  };\n\n  // There is a bug in Safari 10.1 and `Proxy`ing it is not enough.\n  var forSureUsePolyfill = !decodesPlusesCorrectly;\n  var useProxy =\n    !forSureUsePolyfill && nativeURLSearchParams && !isSupportObjectConstructor && self.Proxy;\n  /*\n   * Apply polifill to global object and append other prototype into it\n   */\n  Object.defineProperty(self, 'URLSearchParams', {\n    value: useProxy\n      ? // Safari 10.0 doesn't support Proxy, so it won't extend URLSearchParams on safari 10.0\n        new Proxy(nativeURLSearchParams, {\n          construct: function(target, args) {\n            return new target(new URLSearchParamsPolyfill(args[0]).toString());\n          }\n        })\n      : URLSearchParamsPolyfill\n  });\n\n  var USPProto = self.URLSearchParams.prototype;\n\n  USPProto.polyfill = true;\n\n  /**\n   *\n   * @param {function} callback\n   * @param {object} thisArg\n   */\n  USPProto.forEach =\n    USPProto.forEach ||\n    function(callback, thisArg) {\n      var dict = parseToDict(this.toString());\n      Object.getOwnPropertyNames(dict).forEach(function(name) {\n        dict[name].forEach(function(value) {\n          callback.call(thisArg, value, name, this);\n        }, this);\n      }, this);\n    };\n\n  /**\n   * Sort all name-value pairs\n   */\n  USPProto.sort =\n    USPProto.sort ||\n    function() {\n      var dict = parseToDict(this.toString()),\n        keys = [],\n        k,\n        i,\n        j;\n      for (k in dict) {\n        keys.push(k);\n      }\n      keys.sort();\n\n      for (i = 0; i < keys.length; i++) {\n        this['delete'](keys[i]);\n      }\n      for (i = 0; i < keys.length; i++) {\n        var key = keys[i],\n          values = dict[key];\n        for (j = 0; j < values.length; j++) {\n          this.append(key, values[j]);\n        }\n      }\n    };\n\n  /**\n   * Returns an iterator allowing to go through all keys of\n   * the key/value pairs contained in this object.\n   *\n   * @returns {function}\n   */\n  USPProto.keys =\n    USPProto.keys ||\n    function() {\n      var items = [];\n      this.forEach(function(item, name) {\n        items.push(name);\n      });\n      return makeIterator(items);\n    };\n\n  /**\n   * Returns an iterator allowing to go through all values of\n   * the key/value pairs contained in this object.\n   *\n   * @returns {function}\n   */\n  USPProto.values =\n    USPProto.values ||\n    function() {\n      var items = [];\n      this.forEach(function(item) {\n        items.push(item);\n      });\n      return makeIterator(items);\n    };\n\n  /**\n   * Returns an iterator allowing to go through all key/value\n   * pairs contained in this object.\n   *\n   * @returns {function}\n   */\n  USPProto.entries =\n    USPProto.entries ||\n    function() {\n      var items = [];\n      this.forEach(function(item, name) {\n        items.push([name, item]);\n      });\n      return makeIterator(items);\n    };\n\n  if (iterable) {\n    USPProto[self.Symbol.iterator] = USPProto[self.Symbol.iterator] || USPProto.entries;\n  }\n\n  function encode(str) {\n    var replace = {\n      '!': '%21',\n      \"'\": '%27',\n      '(': '%28',\n      ')': '%29',\n      '~': '%7E',\n      '%20': '+',\n      '%00': '\\x00'\n    };\n    return encodeURIComponent(str).replace(/[!'\\(\\)~]|%20|%00/g, function(match) {\n      return replace[match];\n    });\n  }\n\n  function decode(str) {\n    return str.replace(/[ +]/g, '%20').replace(/(%[a-f0-9]{2})+/gi, function(match) {\n      return decodeURIComponent(match);\n    });\n  }\n\n  function makeIterator(arr) {\n    var iterator = {\n      next: function() {\n        var value = arr.shift();\n        return { done: value === undefined, value: value };\n      }\n    };\n\n    if (iterable) {\n      iterator[self.Symbol.iterator] = function() {\n        return iterator;\n      };\n    }\n\n    return iterator;\n  }\n\n  function parseToDict(search) {\n    var dict = {};\n\n    if (typeof search === 'object') {\n      // if `search` is an array, treat it as a sequence\n      if (isArray(search)) {\n        for (var i = 0; i < search.length; i++) {\n          var item = search[i];\n          if (isArray(item) && item.length === 2) {\n            appendTo(dict, item[0], item[1]);\n          } else {\n            throw new TypeError(\n              \"Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements\"\n            );\n          }\n        }\n      } else {\n        for (var key in search) {\n          if (search.hasOwnProperty(key)) {\n            appendTo(dict, key, search[key]);\n          }\n        }\n      }\n    } else {\n      // remove first '?'\n      if (search.indexOf('?') === 0) {\n        search = search.slice(1);\n      }\n\n      var pairs = search.split('&');\n      for (var j = 0; j < pairs.length; j++) {\n        var value = pairs[j],\n          index = value.indexOf('=');\n\n        if (-1 < index) {\n          appendTo(dict, decode(value.slice(0, index)), decode(value.slice(index + 1)));\n        } else {\n          if (value) {\n            appendTo(dict, decode(value), '');\n          }\n        }\n      }\n    }\n\n    return dict;\n  }\n\n  function appendTo(dict, name, value) {\n    var val =\n      typeof value === 'string'\n        ? value\n        : value !== null && value !== undefined && typeof value.toString === 'function'\n        ? value.toString()\n        : JSON.stringify(value);\n\n    if (name in dict) {\n      dict[name].push(val);\n    } else {\n      dict[name] = [val];\n    }\n  }\n\n  function isArray(val) {\n    return !!val && '[object Array]' === Object.prototype.toString.call(val);\n  }\n})(typeof global !== 'undefined' ? global : typeof window !== 'undefined' ? window : this);\n"],"names":["self","ampersandTest","nativeURLSearchParams","URLSearchParams","prototype","get","isSupportObjectConstructor","a","toString","decodesPlusesCorrectly","__URLSearchParams__","encodesAmpersandsCorrectly","append","URLSearchParamsPolyfill","iterable","Symbol","iterator","search","this","parseToDict","encode","str","replace","!","'","(",")","~","%20","%00","encodeURIComponent","match","decode","decodeURIComponent","makeIterator","arr","next","value","shift","done","undefined","dict","isArray","i","length","item","TypeError","appendTo","key","hasOwnProperty","pairs","indexOf","slice","split","j","index","name","val","JSON","stringify","push","Object","call","getAll","has","set","query","join","useProxy","Proxy","defineProperty","construct","target","args","USPProto","polyfill","forEach","callback","thisArg","getOwnPropertyNames","sort","k","keys","values","items","entries","global","window"],"mappings":"CAQA,SAAUA,gBAGR,IAWYC,EAXRC,EACAF,EAAKG,iBAAmBH,EAAKG,gBAAgBC,UAAUC,IAAML,EAAKG,gBAAkB,KACtFG,EACEJ,GAA4E,QAAnD,IAAIA,EAAsB,CAAEK,EAAG,IAAKC,WAE/DC,EACEP,GAAyE,MAAhD,IAAIA,EAAsB,SAASG,IAAI,KAClEK,EAAsB,sBAEtBC,GAA6BT,KAEnBD,EAAgB,IAAIC,GACVU,OAAO,IAAK,MACU,WAA7BX,EAAcO,YAG3BJ,EAAYS,EAAwBT,UACpCU,KAAcd,EAAKe,SAAUf,EAAKe,OAAOC,UAiB3C,SAASH,EAAwBI,KAC/BA,EAASA,GAAU,cAGGd,iBAAmBc,aAAkBJ,KACzDI,EAASA,EAAOT,YAElBU,KAAKR,GAAuBS,EAAYF,GA8M1C,SAASG,EAAOC,GACd,IAAIC,EAAU,CACZC,IAAK,MACLC,IAAK,MACLC,IAAK,MACLC,IAAK,MACLC,IAAK,MACLC,MAAO,IACPC,MAAO,MAET,OAAOC,mBAAmBT,GAAKC,QAAQ,qBAAsB,SAASS,GACpE,OAAOT,EAAQS,KAInB,SAASC,EAAOX,GACd,OAAOA,EAAIC,QAAQ,QAAS,OAAOA,QAAQ,oBAAqB,SAASS,GACvE,OAAOE,mBAAmBF,KAI9B,SAASG,EAAaC,GACpB,IAAInB,EAAW,CACboB,KAAM,WACJ,IAAIC,EAAQF,EAAIG,QAChB,MAAO,CAAEC,UAAgBC,IAAVH,EAAqBA,MAAOA,KAU/C,OANIvB,IACFE,EAAShB,EAAKe,OAAOC,UAAY,WAC/B,OAAOA,IAIJA,EAGT,SAASG,EAAYF,GACnB,IAAIwB,EAAO,GAEX,GAAsB,iBAAXxB,EAET,GAAIyB,EAAQzB,GACV,IAAK,IAAI0B,EAAI,EAAGA,EAAI1B,EAAO2B,OAAQD,IAAK,CACtC,IAAIE,EAAO5B,EAAO0B,GAClB,IAAID,EAAQG,IAAyB,IAAhBA,EAAKD,OAGxB,MAAM,IAAIE,UACR,+FAHFC,EAASN,EAAMI,EAAK,GAAIA,EAAK,SAQjC,IAAK,IAAIG,KAAO/B,EACVA,EAAOgC,eAAeD,IACxBD,EAASN,EAAMO,EAAK/B,EAAO+B,SAWjC,IADA,IAAIE,GAHFjC,EAD0B,IAAxBA,EAAOkC,QAAQ,KACRlC,EAAOmC,MAAM,GAGZnC,GAAOoC,MAAM,KAChBC,EAAI,EAAGA,EAAIJ,EAAMN,OAAQU,IAAK,CACrC,IAAIjB,EAAQa,EAAMI,GAChBC,EAAQlB,EAAMc,QAAQ,MAEnB,EAAII,EACPR,EAASN,EAAMT,EAAOK,EAAMe,MAAM,EAAGG,IAASvB,EAAOK,EAAMe,MAAMG,EAAQ,KAErElB,GACFU,EAASN,EAAMT,EAAOK,GAAQ,IAMtC,OAAOI,EAGT,SAASM,EAASN,EAAMe,EAAMnB,GACxBoB,EACe,iBAAVpB,EACHA,EACAA,MAAAA,GAAmE,mBAAnBA,EAAM7B,SACtD6B,EAAM7B,WACNkD,KAAKC,UAAUtB,GAEjBmB,KAAQf,EACVA,EAAKe,GAAMI,KAAKH,GAEhBhB,EAAKe,GAAQ,CAACC,GAIlB,SAASf,EAAQe,GACf,OAASA,GAAO,mBAAqBI,OAAOzD,UAAUI,SAASsD,KAAKL,GAxUpEvD,GACAI,GACAG,GACAE,IA2BFP,EAAUQ,OAAS,SAAS4C,EAAMnB,GAChCU,EAAS7B,KAAKR,GAAsB8C,EAAMnB,IAS5CjC,EAAkB,OAAI,SAASoD,UACtBtC,KAAKR,GAAqB8C,IASnCpD,EAAUC,IAAM,SAASmD,GACvB,IAAIf,EAAOvB,KAAKR,GAChB,OAAO8C,KAAQf,EAAOA,EAAKe,GAAM,GAAK,MASxCpD,EAAU2D,OAAS,SAASP,GAC1B,IAAIf,EAAOvB,KAAKR,GAChB,OAAO8C,KAAQf,EAAOA,EAAKe,GAAMJ,MAAM,GAAK,IAS9ChD,EAAU4D,IAAM,SAASR,GACvB,OAAOA,KAAQtC,KAAKR,IAWtBN,EAAU6D,IAAM,SAAaT,EAAMnB,GACjCnB,KAAKR,GAAqB8C,GAAQ,CAAC,GAAKnB,IAQ1CjC,EAAUI,SAAW,WACnB,IAEEmC,EACAK,EACAQ,EACAnB,EALEI,EAAOvB,KAAKR,GACdwD,EAAQ,GAKV,IAAKlB,KAAOP,EAEV,IADAe,EAAOpC,EAAO4B,GACTL,EAAI,EAAGN,EAAQI,EAAKO,GAAML,EAAIN,EAAMO,OAAQD,IAC/CuB,EAAMN,KAAKJ,EAAO,IAAMpC,EAAOiB,EAAMM,KAGzC,OAAOuB,EAAMC,KAAK,MAKhBC,IADsB3D,GAEDP,IAA0BI,GAA8BN,EAAKqE,MAItFR,OAAOS,eAAetE,EAAM,kBAAmB,CAC7CqC,MAAO+B,EAEH,IAAIC,MAAMnE,EAAuB,CAC/BqE,UAAW,SAASC,EAAQC,GAC1B,OAAO,IAAID,EAAO,IAAI3D,EAAwB4D,EAAK,IAAIjE,eAG3DK,KAGF6D,EAAW1E,EAAKG,gBAAgBC,WAE3BuE,UAAW,EAOpBD,EAASE,QACPF,EAASE,SACT,SAASC,EAAUC,GACjB,IAAIrC,EAAOtB,EAAYD,KAAKV,YAC5BqD,OAAOkB,oBAAoBtC,GAAMmC,QAAQ,SAASpB,GAChDf,EAAKe,GAAMoB,QAAQ,SAASvC,GAC1BwC,EAASf,KAAKgB,EAASzC,EAAOmB,EAAMtC,OACnCA,OACFA,OAMPwD,EAASM,KACPN,EAASM,MACT,WACE,IAEEC,EACAtC,EAHEF,EAAOtB,EAAYD,KAAKV,YAC1B0E,EAAO,GAIT,IAAKD,KAAKxC,EACRyC,EAAKtB,KAAKqB,GAIZ,IAFAC,EAAKF,OAEArC,EAAI,EAAGA,EAAIuC,EAAKtC,OAAQD,IAC3BzB,KAAa,OAAEgE,EAAKvC,IAEtB,IAAKA,EAAI,EAAGA,EAAIuC,EAAKtC,OAAQD,IAG3B,IAFA,IAAIK,EAAMkC,EAAKvC,GACbwC,EAAS1C,EAAKO,GACXM,EAAI,EAAGA,EAAI6B,EAAOvC,OAAQU,IAC7BpC,KAAKN,OAAOoC,EAAKmC,EAAO7B,KAWhCoB,EAASQ,KACPR,EAASQ,MACT,WACE,IAAIE,EAAQ,GAIZ,OAHAlE,KAAK0D,QAAQ,SAAS/B,EAAMW,GAC1B4B,EAAMxB,KAAKJ,KAENtB,EAAakD,IASxBV,EAASS,OACPT,EAASS,QACT,WACE,IAAIC,EAAQ,GAIZ,OAHAlE,KAAK0D,QAAQ,SAAS/B,GACpBuC,EAAMxB,KAAKf,KAENX,EAAakD,IASxBV,EAASW,QACPX,EAASW,SACT,WACE,IAAID,EAAQ,GAIZ,OAHAlE,KAAK0D,QAAQ,SAAS/B,EAAMW,GAC1B4B,EAAMxB,KAAK,CAACJ,EAAMX,MAEbX,EAAakD,IAGpBtE,IACF4D,EAAS1E,EAAKe,OAAOC,UAAY0D,EAAS1E,EAAKe,OAAOC,WAAa0D,EAASW,UAvPhF,CAiWqB,oBAAXC,OAAyBA,OAA2B,oBAAXC,OAAyBA,OAASrE"}