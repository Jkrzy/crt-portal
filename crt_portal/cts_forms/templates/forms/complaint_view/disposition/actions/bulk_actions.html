{% extends "forms/complaint_view/show/card.html" %}

{% load i18n %}

{% block title %}Approve multiple records for disposition{% endblock %}

{% block extra_classes %}crt-actions-card{% endblock %}

{% block icon %}
  <img src="{% static "img/intake-icons/ic_check-circle.svg" %}" alt="icon" class="icon" />
{% endblock %}

{% block card_content %}
  {% if ids_count %}
    <form class="usa-form" method="post" novalidate>
      {% csrf_token %}

      <input type="hidden" value="{{ return_url_args }}" name="next" id="next" />
      <input type="hidden" value="{{ ids }}" name="ids" id="ids" />
      <input type="hidden" value="{{ selected_all }}" name="all" id="all" />
      <input type="hidden" value="{{ query_string }}" name="query_string" id="query_string" />

      <div id="bulk_actions_section">
        <div class="margin-bottom-2 crt-textarea">
          <label for="id_comment" class="intake-label">
            {{ bulk_actions_form.comment.label }}
            <span class="field-required">{% trans "required" %}</span>
          </label>
          {{ bulk_actions_form.comment}}
        </div>

        <button class="usa-button{% if show_warning %} button--warning display-flex align-center{% endif %}"
                {% if show_warning %}id="show_warning_section_partial"{% endif %}
                disabled
                type="submit"
                name="selected_ids"
        >
          Approve {{ ids_count }} record{{ ids_count|pluralize:"s" }} for disposition
        </button>

        {% if selected_all %}
          {% if all_ids_count <= 500 %}
            <button class="usa-button button--warning display-flex align-center"
                    id="show_warning_section"
                    disabled
            >
              Apply changes to {{ all_ids_count }} record{{ all_ids_count|pluralize:"s" }}
            </button>
          {% else %}
            <p>
              Maximum records for bulk change is capped at 500. Please return to the <a href="{% url 'crt_forms:crt-forms-index' %}{{ return_url_args }}">View All Table</a> and adjust your filters.
            </p>
          {% endif %}
        {% endif %}
      </div>

      {% if show_warning or selected_all %}
        <div id="warning_section" hidden>
          <p>
            Are you sure you want to update
            <span id="warning_count_all">{{ all_ids_count }}</span>
            <span id="warning_count_partial">{{ ids_count }}</span>
            records?
          </p>
          <button class="usa-button button--warning display-flex align-center"
                  id="confirm_button"
                  name="confirm_all"
                  value="confirm_all"
                  type="submit">
            Yes
          </button>
          <button class="usa-button"
                  id="cancel_warning_section">
            No
          </button>
        </div>
      {% endif %}
    </form>
  {% else %}
    <p>No records were selected.</p>
  {% endif %}
{% endblock %}