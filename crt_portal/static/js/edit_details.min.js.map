{"version":3,"file":"edit_details.min.js","sources":["edit_details.js"],"sourcesContent":["(function() {\n  function showForm() {\n    var showThese = document.querySelectorAll('.details-edit');\n    var hideThese = document.querySelectorAll('.details');\n\n    for (var i = 0; i < hideThese.length; i++) {\n      hideThese[i].classList.add('display-none');\n    }\n\n    for (var i = 0; i < showThese.length; i++) {\n      showThese[i].classList.remove('display-none');\n    }\n\n    // Show follow-up fields if any\n    var primaryComplaint = document.getElementById('id_primary_complaint');\n    showFollowUpQuestions(primaryComplaint.value);\n\n    // reveal Buttons\n    var buttons = detailsForm.getElementsByTagName('button');\n    for (var i = 0; i < buttons.length; i++) {\n      buttons[i].classList.remove('display-none');\n    }\n  }\n\n  function hideForm() {\n    var hideThese = document.querySelectorAll('.details-edit');\n    var showThese = document.querySelectorAll('.details');\n\n    for (var i = 0; i < hideThese.length; i++) {\n      // This allows us to conditionally prevent hiding of elements\n      // Such as the complaint summary field when there is none existing\n      var element = hideThese[i];\n      if (!element.classList.contains('always-display')) {\n        element.classList.add('display-none');\n      }\n    }\n\n    for (var i = 0; i < showThese.length; i++) {\n      showThese[i].classList.remove('display-none');\n    }\n\n    // Hide Buttons\n    var buttons = detailsForm.getElementsByTagName('button');\n    for (var i = 0; i < buttons.length; i++) {\n      var element = buttons[i];\n      if (!element.classList.contains('always-display')) {\n        element.classList.add('display-none');\n      }\n    }\n  }\n\n  function addShowFormHandler() {\n    var editButton = document.getElementById('edit-details-btn');\n    editButton.addEventListener('click', showForm);\n  }\n\n  function getFormState(form) {\n    //  Serialize form values into a comma delimited string\n    var serializedForm = new Array();\n    for (var i = 0; i < form.elements.length; i++) {\n      var field = form.elements[i];\n      if (field.type != 'checkbox') {\n        serializedForm.push(field.value);\n      } else {\n        serializedForm.push(field.checked);\n      }\n    }\n    return serializedForm.join(',');\n  }\n\n  function setButtonDisabled() {\n    // Save Button only enabled if form has been modified\n    var currentState = getFormState(detailsForm);\n    if (initialState === currentState) {\n      saveButton.setAttribute('disabled', true);\n    } else {\n      saveButton.removeAttribute('disabled');\n    }\n  }\n\n  function addFormUpdateEvents(form) {\n    // Show follow-up fields if any\n    var primaryComplaint = document.getElementById('id_primary_complaint');\n    showFollowUpQuestions(primaryComplaint.value);\n\n    // Generate listenable events for all form inputs, using `change` for IE11 support\n    for (var i = 0; i < form.elements.length; i++) {\n      var field = form.elements[i];\n      if (field.nodeName == 'INPUT' || field.nodeName == 'TEXTAREA') {\n        field.addEventListener('input', setButtonDisabled);\n      } else if (field.nodeName == 'SELECT') {\n        field.addEventListener('change', setButtonDisabled);\n      }\n    }\n  }\n\n  function popField(array, field) {\n    var index = array.indexOf(field);\n    if (index > -1) {\n      array.splice(index, 1);\n    }\n    return array;\n  }\n\n  function showFollowUpQuestions(selectedReason) {\n    var allOptionalFields = [\n      'public_or_private_employer',\n      'employer_size',\n      'public_or_private_school',\n      'inside_correctional_facility',\n      'correctional_facility_type',\n      'commercial_or_public_place',\n      'other_commercial_or_public_place'\n    ];\n\n    var followupMapping = {\n      workplace: ['public_or_private_employer', 'employer_size'],\n      education: ['public_or_private_school'],\n      police: ['inside_correctional_facility', 'correctional_facility_type'],\n      commercial_or_public: ['commercial_or_public_place', 'other_commercial_or_public_place']\n    };\n\n    // pick out and show dependent fields\n    if (selectedReason in followupMapping) {\n      var show_these_fields = followupMapping[selectedReason];\n      for (i = 0; i < show_these_fields.length; i++) {\n        var field = show_these_fields[i];\n        var target_id = 'edit_id_' + show_these_fields[i];\n        var target = document.getElementById(target_id);\n        target.style.display = 'block';\n\n        allOptionalFields = popField(allOptionalFields, field);\n      }\n    }\n\n    // hide remaining fields\n    for (i = 0; i < allOptionalFields.length; i++) {\n      var target_id = 'edit_id_' + allOptionalFields[i];\n      var target = document.getElementById(target_id);\n      target.style.display = 'none';\n    }\n  }\n\n  function toggleFollowUpQuestions(event) {\n    showFollowUpQuestions(event.target.value);\n  }\n\n  var detailsInfo = document.getElementById('report-details');\n  var detailsForm = document.getElementById('details-edit-form');\n  var saveButton = detailsForm.getElementsByTagName('button')[0];\n  var cancelButton = detailsForm.getElementsByClassName('button--cancel')[0];\n  var primaryIssues = document.getElementById('id_primary_complaint');\n\n  // add listeners\n  primaryIssues.addEventListener('change', toggleFollowUpQuestions);\n  cancelButton.addEventListener('click', hideForm);\n\n  var initialState = getFormState(detailsForm);\n\n  addFormUpdateEvents(detailsForm);\n  addShowFormHandler();\n})();\n"],"names":["showForm","showThese","document","querySelectorAll","hideThese","i","length","classList","add","remove","showFollowUpQuestions","getElementById","value","buttons","detailsForm","getElementsByTagName","getFormState","form","serializedForm","Array","elements","field","type","push","checked","join","setButtonDisabled","currentState","initialState","saveButton","setAttribute","removeAttribute","selectedReason","allOptionalFields","followupMapping","workplace","education","police","commercial_or_public","show_these_fields","target_id","style","display","index","array","indexOf","splice","cancelButton","getElementsByClassName","addEventListener","event","target","element","contains","nodeName","addFormUpdateEvents"],"mappings":"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"}